{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "GemStone (Topaz)",
  "scopeName": "source.gemstone-topaz",
  "patterns": [
    { "include": "#topaz-code-block" },
    { "include": "#topaz-method-block" },
    { "include": "#topaz-terminator" },
    { "include": "#topaz-comment" },
    { "include": "#topaz-command" }
  ],
  "repository": {
    "topaz-code-block": {
      "begin": "^\\s*(?i)(run|doit|print(?:it)?)\\s*$",
      "end": "^%\\s*$",
      "beginCaptures": {
        "1": { "name": "keyword.control.topaz.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.terminator.topaz.gemstone-smalltalk" }
      },
      "contentName": "meta.smalltalk-code.gemstone-smalltalk",
      "patterns": [
        { "include": "#smalltalk" }
      ]
    },
    "topaz-method-block": {
      "begin": "^\\s*(?i)(method|classmethod):?\\s*(.*)?$",
      "end": "^%\\s*$",
      "beginCaptures": {
        "1": { "name": "keyword.control.topaz.gemstone-smalltalk" },
        "2": { "name": "entity.name.type.class.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.terminator.topaz.gemstone-smalltalk" }
      },
      "contentName": "meta.smalltalk-method.gemstone-smalltalk",
      "patterns": [
        { "include": "#smalltalk" }
      ]
    },
    "topaz-terminator": {
      "name": "punctuation.terminator.topaz.gemstone-smalltalk",
      "match": "^%\\s*$"
    },
    "topaz-comment": {
      "name": "comment.line.topaz.gemstone-smalltalk",
      "match": "^\\s*!.*$"
    },
    "topaz-command": {
      "match": "^\\s*(?i)(abort|begin|category|commit|display|edit|errorcount|exec|exit|expecterror|expectvalue|fileout|filein|iferr(?:or)?|input|level|limit|list|login|logout|lookup|obj(?:ect)?|omit|output|pausealiasing|protect|quit|releaseall|removeall(?:class)?methods|send|set|shell|spawn|stack|stk|time|topaz|where)\\b(.*)?$",
      "captures": {
        "1": { "name": "keyword.other.topaz.gemstone-smalltalk" },
        "2": { "name": "string.unquoted.topaz-args.gemstone-smalltalk" }
      }
    },

    "smalltalk": {
      "patterns": [
        { "include": "#st-comment" },
        { "include": "#st-string" },
        { "include": "#st-symbol-string" },
        { "include": "#st-symbol" },
        { "include": "#st-character-literal" },
        { "include": "#st-byte-array-literal" },
        { "include": "#st-array-literal" },
        { "include": "#st-number" },
        { "include": "#st-return" },
        { "include": "#st-assignment" },
        { "include": "#st-pragma" },
        { "include": "#st-special-literal" },
        { "include": "#st-pseudo-variable" },
        { "include": "#st-env-specifier" },
        { "include": "#st-block-parameter" },
        { "include": "#st-temporaries" },
        { "include": "#st-keyword-send" },
        { "include": "#st-cascade" },
        { "include": "#st-binary-selector" },
        { "include": "#st-curly-brace" },
        { "include": "#st-identifier" }
      ]
    },
    "st-comment": {
      "name": "comment.block.gemstone-smalltalk",
      "begin": "\"",
      "end": "\"",
      "patterns": []
    },
    "st-string": {
      "name": "string.quoted.single.gemstone-smalltalk",
      "begin": "'",
      "end": "'",
      "patterns": [
        {
          "name": "constant.character.escape.gemstone-smalltalk",
          "match": "''"
        }
      ]
    },
    "st-symbol-string": {
      "name": "constant.other.symbol.gemstone-smalltalk",
      "begin": "#'",
      "end": "'",
      "patterns": [
        {
          "name": "constant.character.escape.gemstone-smalltalk",
          "match": "''"
        }
      ]
    },
    "st-symbol": {
      "name": "constant.other.symbol.gemstone-smalltalk",
      "match": "#[a-zA-Z_][a-zA-Z0-9_:]*"
    },
    "st-character-literal": {
      "name": "constant.character.gemstone-smalltalk",
      "match": "\\$."
    },
    "st-number": {
      "name": "constant.numeric.gemstone-smalltalk",
      "match": "-?\\b\\d+([rR#][0-9A-Za-z]+|(\\.[0-9]+)?([eEdDqQfFpPsS]-?[0-9]*)?)\\b"
    },
    "st-special-literal": {
      "name": "constant.language.gemstone-smalltalk",
      "match": "\\b(true|false|nil|_remoteNil)\\b"
    },
    "st-pseudo-variable": {
      "name": "variable.language.gemstone-smalltalk",
      "match": "\\b(self|super|thisContext)\\b"
    },
    "st-return": {
      "name": "keyword.control.return.gemstone-smalltalk",
      "match": "\\^"
    },
    "st-assignment": {
      "name": "keyword.operator.assignment.gemstone-smalltalk",
      "match": ":=|(?<=\\s)_(?=\\s)"
    },
    "st-env-specifier": {
      "name": "storage.modifier.env.gemstone-smalltalk",
      "match": "@env\\d+:"
    },
    "st-block-parameter": {
      "match": "(:[a-zA-Z_][a-zA-Z0-9_]*)",
      "captures": {
        "1": { "name": "variable.parameter.block.gemstone-smalltalk" }
      }
    },
    "st-temporaries": {
      "begin": "(?<=^|\\[|\\])\\s*(\\|)",
      "end": "(\\|)",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.temporaries.begin.gemstone-smalltalk" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.temporaries.end.gemstone-smalltalk" }
      },
      "patterns": [
        { "include": "#st-comment" },
        {
          "name": "variable.other.temporary.gemstone-smalltalk",
          "match": "[a-zA-Z_][a-zA-Z0-9_]*"
        }
      ]
    },
    "st-keyword-send": {
      "name": "entity.name.function.keyword.gemstone-smalltalk",
      "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*:"
    },
    "st-binary-selector": {
      "name": "keyword.operator.binary.gemstone-smalltalk",
      "match": "[+\\-\\\\*~<>=|/&@%,?!]{1,2}"
    },
    "st-cascade": {
      "name": "punctuation.separator.cascade.gemstone-smalltalk",
      "match": ";"
    },
    "st-pragma": {
      "name": "meta.pragma.gemstone-smalltalk",
      "begin": "<",
      "end": ">",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.pragma.begin.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.pragma.end.gemstone-smalltalk" }
      },
      "patterns": [
        { "include": "#st-comment" },
        { "include": "#st-string" },
        { "include": "#st-number" },
        { "include": "#st-special-literal" },
        { "include": "#st-symbol-string" },
        { "include": "#st-symbol" },
        { "include": "#st-character-literal" },
        {
          "name": "keyword.other.pragma.gemstone-smalltalk",
          "match": "\\b(primitive|protected|unprotected)\\b"
        },
        { "include": "#st-keyword-send" },
        { "include": "#st-identifier" }
      ]
    },
    "st-array-literal": {
      "name": "meta.array-literal.gemstone-smalltalk",
      "begin": "#\\(",
      "end": "\\)",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.array.begin.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.array.end.gemstone-smalltalk" }
      },
      "patterns": [
        { "include": "#st-comment" },
        { "include": "#st-string" },
        { "include": "#st-symbol-string" },
        { "include": "#st-symbol" },
        { "include": "#st-character-literal" },
        { "include": "#st-number" },
        { "include": "#st-special-literal" },
        { "include": "#st-array-literal" },
        { "include": "#st-byte-array-literal" },
        {
          "name": "constant.other.symbol.gemstone-smalltalk",
          "match": "[a-zA-Z_][a-zA-Z0-9_:]*"
        }
      ]
    },
    "st-byte-array-literal": {
      "name": "meta.byte-array-literal.gemstone-smalltalk",
      "begin": "#\\[",
      "end": "\\]",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.byte-array.begin.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.byte-array.end.gemstone-smalltalk" }
      },
      "patterns": [
        { "include": "#st-comment" },
        { "include": "#st-number" }
      ]
    },
    "st-curly-brace": {
      "begin": "\\{",
      "end": "\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.curly.begin.gemstone-smalltalk" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.curly.end.gemstone-smalltalk" }
      },
      "patterns": [
        { "include": "#smalltalk" }
      ]
    },
    "st-identifier": {
      "name": "variable.other.gemstone-smalltalk",
      "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
    }
  }
}
